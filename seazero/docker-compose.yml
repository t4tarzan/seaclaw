# SeaZero — Agent Zero Container Configuration
# Lean setup: just Agent Zero + SeaClaw bridge. No Redis, no Postgres.
#
# Usage:
#   docker compose up -d          # Start Agent Zero
#   docker compose logs -f        # Watch logs
#   docker compose down           # Stop
#
# SeaClaw runs natively (203KB binary), NOT in Docker.
# Agent Zero runs in Docker for isolation.

services:
  # ── Agent Zero (Python/Kali) ──────────────────────────────
  agent-zero:
    image: seazero/agent-zero:latest
    build:
      context: .
      dockerfile: Dockerfile.agent-zero
    container_name: seazero-agent-0
    restart: unless-stopped

    # Security: drop all capabilities, no privilege escalation, seccomp
    security_opt:
      - no-new-privileges:true
      - seccomp=config/seccomp.json
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:size=256M
      - /run:size=64M

    # Resource limits: prevent runaway agents
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 2G
        reservations:
          cpus: '0.25'
          memory: 512M
    pids_limit: 100

    # Volumes: agent workspace (persistent), shared with SeaClaw
    volumes:
      - agent_data:/agent/workdir:rw
      - agent_memory:/agent/memory:rw
      - ${HOME:-.}/.seazero/workspace:/agent/shared:rw

    # Network: only accessible from localhost
    ports:
      - "127.0.0.1:8080:8080"

    # Network: isolated — can reach SeaClaw proxy + internet, not LAN
    networks:
      - seazero_net
    dns:
      - 8.8.8.8
      - 1.1.1.1

    environment:
      - AGENT_ID=agent-0
      - AGENT_PORT=8080
      # LLM: routed through SeaClaw proxy — Agent Zero never sees real API key
      - OPENAI_API_BASE=http://host.docker.internal:7432
      - OPENAI_API_KEY=${SEAZERO_INTERNAL_TOKEN:-}
      # SeaClaw bridge callback
      - SEACLAW_CALLBACK_URL=http://host.docker.internal:7432
      # Logging
      - LOG_LEVEL=${LOG_LEVEL:-info}

    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:8080/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 15s

networks:
  seazero_net:
    driver: bridge
    internal: false

volumes:
  agent_data:
    driver: local
  agent_memory:
    driver: local
